name: Keep Alive

on:
  schedule:
    # Every 10 minutes from 06:00 to 22:00 CET (05:00-21:00 UTC)
    - cron: '*/10 5-21 * * *'
  workflow_dispatch: # Allow manual trigger

permissions:
  contents: read

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Health Endpoint
        run: |
          response=$(curl -s -o /dev/null -w "%{http_code}" --max-time 60 https://skigebiete-muenchen-backend.onrender.com/health)
          echo "Health check response: $response"
          if [ "$response" != "200" ]; then
            echo "Warning: Health endpoint returned $response"
          fi
      
      - name: Verify API Ready
        run: |
          # Wait for backend to fully initialize after wake
          sleep 5
          count=$(curl -s --max-time 30 https://skigebiete-muenchen-backend.onrender.com/api/resorts | jq 'length' 2>/dev/null || echo "0")
          echo "Resorts loaded: $count"
