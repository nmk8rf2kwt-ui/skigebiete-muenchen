<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Where to Go?</title>
  <link rel="icon" type="image/png" href="favicon.png?v=2" />
  <link rel="apple-touch-icon" href="favicon.png?v=2" />
  <link rel="stylesheet" href="css/style.css?v=1.11.6" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="" defer></script>
  <!-- Chart.js -->


  <!-- Sentry Error Tracking -->
  <script src="https://js-de.sentry-cdn.com/98d563b2786c52b90b69b86e93237434.min.js" crossorigin="anonymous"></script>
  <script type="module" src="js/sentry-config.js"></script>
</head>

<body>


  <header class="main-header">
    <h1 id="mainTitle">Where to Go?</h1>
    <p class="subtitle">ğŸ”ï¸ Winter-Activities</p>
    <p id="activityContext" class="subtitle-context"></p>
    <a href="admin/dashboard.html" target="_blank" title="Admin Dashboard" id="adminLink">âš™ï¸</a>
  </header>




  <!-- Guided Search Wizard -->
  <div id="wizardContainer" class="wizard-container">

    <!-- Error & Status Containers -->
    <div id="searchError" class="search-error" style="display: none;">
      <div id="errorContent"></div>
    </div>
    <div id="statusConsole" style="display: none;">
      <div id="statusContent"></div>
    </div>

    <!-- Step 1: Location -->
    <div id="step-location" class="wizard-step active">
      <div class="step-header">
        <span class="step-badge">Schritt 1 von 3</span>
        <h2 id="locationHeadingElement">ğŸ”ï¸ Von wo startest du?</h2>
      </div>
      <p class="step-desc">Gib deinen Standort ein, um prÃ¤zise Fahrzeiten und Stauprognosen zu erhalten.</p>

      <div class="search-group-wizard">
        <div class="input-wrapper-wizard">
          <input type="text" id="addressInput" placeholder="MÃ¼nchen, Marienplatz" autocomplete="off" />
          <button id="locateBtn" class="locate-icon-btn" title="Meinen Standort verwenden">ğŸ“</button>
        </div>
        <button id="submitLocationBtn" class="wizard-next-btn">Weiter</button>
      </div>
    </div>

    <!-- Step 2: Activity Picker -->
    <div id="step-activity" class="wizard-step">
      <div class="step-header">
        <span class="step-badge">Schritt 2 von 3</span>
        <h2>Womit startest du heute?</h2>
      </div>
      <p class="step-desc">WÃ¤hle dein heutiges Winter-Abenteuer.</p>

      <div class="pref-grid" id="activityPicker">
        <button class="pref-btn" data-domain="ski">
          <span class="pref-icon">ğŸ¿</span>
          <span class="pref-label">Skifahren</span>
          <small class="text-gray text-xs">Heute sinnvoll?</small>
        </button>
        <button class="pref-btn" data-domain="skate">
          <span class="pref-icon">â›¸ï¸</span>
          <span class="pref-label">Eislaufen</span>
          <small class="text-gray text-xs">Heute freigegeben?</small>
        </button>
        <button class="pref-btn" data-domain="sled">
          <span class="pref-icon">ğŸ›·</span>
          <span class="pref-label">Rodeln</span>
          <small class="text-gray text-xs">Heute rodelbar?</small>
        </button>
        <button class="pref-btn" data-domain="skitour">
          <span class="pref-icon">ğŸ”ï¸</span>
          <span class="pref-label">Skitour</span>
          <small class="text-gray text-xs">Pulver oder Harsch?</small>
        </button>
      </div>

      <!-- 5th Activity Button (Full Width) -->
      <button class="pref-btn pref-btn-full" data-domain="walk">
        <span class="pref-icon text-2xl mr-lg">ğŸš¶</span>
        <div class="text-left">
          <span class="pref-label">Winterwanderung</span>
          <small class="text-gray d-block text-sm">Gut begehbar?</small>
        </div>
      </button>

      <div class="step-footer mt-lg">
        <button id="backToLocationFromActivity" class="wizard-back-btn">â† ZurÃ¼ck</button>
      </div>
    </div>

    <!-- Step 3: Preferences -->
    <div id="step-prefs" class="wizard-step">
      <div class="step-header">
        <span class="step-badge">Schritt 3 von 3</span>
        <h2>â›·ï¸ Was ist dir heute wichtig?</h2>
      </div>
      <p class="step-desc">Wir passen den SmartScore basierend auf deinen Vorlieben an.</p>

      <div class="pref-grid">
        <button class="pref-btn" data-pref="travel">
          <span class="pref-icon">ğŸš€</span>
          <span class="pref-label">Schnell & wenig Stau</span>
        </button>
        <button class="pref-btn" data-pref="conditions">
          <span class="pref-icon">âœ¨</span>
          <span class="pref-label">Gute Bedingungen</span>
          <small class="text-gray text-xs">Schnee & Lifte</small>
        </button>
        <button class="pref-btn" data-pref="weather">
          <span class="pref-icon">â˜€ï¸</span>
          <span class="pref-label">Gutes Wetter</span>
        </button>
        <button class="pref-btn" data-pref="large">
          <span class="pref-icon">ğŸ”ï¸</span>
          <span class="pref-label">GroÃŸes Skigebiet</span>
        </button>
        <button class="pref-btn" data-pref="easy">
          <span class="pref-icon">ï¿½</span>
          <span class="pref-label">Einfaches Skigebiet</span>
        </button>
        <button class="pref-btn" data-pref="price">
          <span class="pref-icon">ğŸ’°</span>
          <span class="pref-label">GÃ¼nstig</span>
        </button>
      </div>

      <div class="step-footer d-flex gap-md mt-lg">
        <button id="backToActivity" class="wizard-back-btn">â† ZurÃ¼ck</button>
        <!-- Next button hidden as selection auto-submits -->
        <button id="showResultsBtn" class="wizard-next-btn bg-success d-none">Empfehlungen zeigen</button>
      </div>
    </div>
  </div>

  <!-- Step 3: Results View -->
  <div id="resultsView" class="p-lg d-none">
    <div class="results-top-bar d-flex items-center justify-between mb-lg">
      <h2 id="resultsHeading" class="m-0 text-2xl text-dark"></h2>

      <div class="view-switcher-wizard">
        <button class="view-btn active" data-view="top3">Top 3</button>
        <button class="view-btn" data-view="map">Karte</button>
        <button class="view-btn" data-view="table">Tabelle</button>
      </div>
    </div>

    <!-- Filter Chips (New v1.11.6) -->
    <div id="resultsFilterContainer" class="results-filter-container"></div>

    <!-- Top 3 Recommendation Cards -->
    <div id="top3Cards" class="top3-container"></div>

    <!-- Map View (Hidden by default, used in Step 3) -->
    <div id="map-view" class="d-none h-full w-full my-lg border-radius-lg z-10"
      style="height: 600px; position: relative;">
      <div id="map-controls"
        style="position: absolute; top: 12px; right: 12px; z-index: 1000; background: rgba(255,255,255,0.9); padding: 8px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.15); display: flex; gap: 5px; align-items: center;">
        <span style="font-size: 12px; font-weight: 600; color: #555; margin-right: 4px;">Umkreis:</span>
        <button onclick="setMapDistance(50)" class="map-filter-btn"
          style="font-size:11px; padding:4px 8px; border:1px solid #ddd; border-radius:12px; background:white; cursor:pointer;">50
          km</button>
        <button onclick="setMapDistance(100)" class="map-filter-btn"
          style="font-size:11px; padding:4px 8px; border:1px solid #ddd; border-radius:12px; background:white; cursor:pointer;">100
          km</button>
        <button onclick="setMapDistance(150)" class="map-filter-btn"
          style="font-size:11px; padding:4px 8px; border:1px solid #ddd; border-radius:12px; background:white; cursor:pointer;">150
          km</button>
        <button onclick="setMapDistance(200)" class="map-filter-btn"
          style="font-size:11px; padding:4px 8px; border:1px solid #ddd; border-radius:12px; background:white; cursor:pointer;">200
          km</button>
      </div>
    </div>

    <!-- Table View (Hidden by default) -->
    <div id="tableView" class="d-none">
      <table id="skiTable">
        <thead>
          <tr>
            <th data-sort="smartScore" title="SmartScore (0-100)" class="cursor-pointer" style="min-width: 60px;">Score
              â†•ï¸</th>
            <th class="text-left">Gebiet</th>
            <th>Typ</th>
            <th>GrÃ¶ÃŸe</th>
            <th>Lifte</th>
            <th data-sort="price" class="cursor-pointer">Preis â†•ï¸</th>
            <th data-sort="distance_km" class="cursor-pointer">Distanz â†•ï¸</th>
            <th>Fahrzeit (Netto)</th>
            <th>Delay</th>
            <th data-sort="traffic_duration" class="cursor-pointer">Fahrzeit (Live) â†•ï¸</th>
            <th>Prognose</th>
            <th>Wetter</th>
            <th data-sort="snow" class="cursor-pointer">Schnee â†•ï¸</th>
            <th>Webcam</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody id="resortRows">
        </tbody>
      </table>
    </div> <!-- End of #tableView -->

    <div class="text-center my-lg" style="margin: 40px 0;">
      <button id="loadMore3" class="wizard-restart-btn text-link font-bold cursor-pointer"
        style="background: #3498db; color: white; border: none; padding: 12px 24px; border-radius: 20px; margin-bottom: 16px;">3
        weitere laden</button>
      <br>
      <button id="restartWizard" class="wizard-restart-btn text-link font-bold cursor-pointer"
        style="background: none; border: 2px solid #3498db; padding: 10px 20px; border-radius: 20px;">â†
        PrioritÃ¤t Ã¤ndern</button>
    </div>
  </div> <!-- End of #resultsView -->

  <!-- Weather Modal -->
  <div id="weatherModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="weatherResortName">Weather Forecast</h2>
      <div id="weatherForecast" class="weather-forecast">
        <p>Loading...</p>
      </div>
    </div>
  </div>

  <!-- Details Modal -->
  <div id="detailsModal" class="modal">
    <div class="modal-content">
      <span class="close-details">&times;</span>
      <h2 id="detailsResortName">Details</h2>
      <div id="detailsContent"></div>
    </div>
  </div>

  <!-- Score Info Modal -->
  <div id="scoreModal" class="modal">
    <div class="modal-content score-modal-content">
      <span class="close-score">&times;</span>
      <h2>Was ist der SmartScore?</h2>
      <p>Der SmartScore (0-100) bewertet Skigebiete tagesaktuell basierend auf drei Hauptfaktoren:</p>

      <div class="score-breakdown">
        <div class="score-factor">
          <div class="factor-icon">â„ï¸</div>
          <div class="factor-text">
            <strong>Schnee & Pisten (50%)</strong>
            <p>SchneehÃ¶he am Berg und im Tal sowie der Anteil der geÃ¶ffneten Pistenkilometer.</p>
          </div>
        </div>
        <div class="score-factor">
          <div class="factor-icon">ğŸš—</div>
          <div class="factor-text">
            <strong>Erreichbarkeit (30%)</strong>
            <p>Fahrzeit von deinem Standort inklusive aktueller Staumeldungen und VerzÃ¶gerungen.</p>
          </div>
        </div>
        <div class="score-factor">
          <div class="factor-icon">ğŸš </div>
          <div class="factor-text">
            <strong>Angebotsvielfalt (20%)</strong>
            <p>Anzahl der geÃ¶ffneten Lifte und das allgemeine Preis-Leistungs-VerhÃ¤ltnis.</p>
          </div>
        </div>
      </div>

      <blockquote>
        <p><strong>Tipp:</strong> Ein Score Ã¼ber 80 bedeutet perfekte Bedingungen fÃ¼r einen Tagestrip!</p>
      </blockquote>
    </div>
  </div>

  <!-- TRAFFIC MODAL (Formerly History Modal) -->
  <div id="historyModal" class="modal">
    <div class="modal-content">
      <span class="close-history">&times;</span>
      <h2 id="historyResortName">Verkehrsprognose</h2>

      <!-- Content (No Tabs) -->
      <div id="trafficTab" class="tab-content" style="display: block;">
        <p class="info-text">
          Durchschnittliche VerkehrsverzÃ¶gerung pro Wochentag/Uhrzeit (gemittelt Ã¼ber letzten Monat)
        </p>
        <canvas id="trafficHistoryChart"></canvas>
      </div>

    </div>
  </div>




  <script type="module" src="js/app.js?v=1.11.1"></script>

  <!-- Footer -->
  <footer class="footer-container">
    <div class="footer-content centered-footer">
      <p class="footer-copyright">
        Â© 2026 Where to Go?
      </p>
      <p class="text-xs text-light-gray mt-md">
        v1.11.5 â€¢ <a href="#" id="imprintLink" class="footer-link-gray">Impressum</a>
        <span class="text-gray separator">|</span>
        <a href="datenschutz.html" class="footer-link-gray">DatenschutzerklÃ¤rung</a>
      </p>
      <p class="footer-disclaimer text-light-gray">
        Datenquellen: APIs der Skigebiete, Open-Meteo, TomTom, OpenStreetMap
      </p>
    </div>
  </footer>
</body>

</html>