<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skigebiets-Finder</title>
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-eval' https://unpkg.com https://cdn.jsdelivr.net https://js-de.sentry-cdn.com https://browser.sentry-cdn.com; style-src 'self' 'unsafe-inline' https://unpkg.com; img-src 'self' data: https:; connect-src 'self' http: https: ws:; worker-src 'self' blob:;">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="" defer></script>
  <!-- Chart.js -->


  <!-- Sentry Error Tracking -->
  <script src="https://js-de.sentry-cdn.com/98d563b2786c52b90b69b86e93237434.min.js" crossorigin="anonymous"></script>
  <script type="module" src="js/sentry-config.js"></script>
</head>

<body>


  <h1 id="mainTitle">ğŸ”ï¸ Winter-Finder</h1>

  <div class="meta">
    Stand: <span id="timestamp">â€“</span> Â· <span class="text-gray text-md">v1.10.1</span>
    <a href="admin/dashboard.html" target="_blank" title="Admin Dashboard"
      class="decoration-none opacity-50 ml-sm">âš™ï¸</a>
  </div>




  <!-- Guided Search Wizard -->
  <div id="wizardContainer" class="wizard-container">

    <!-- Error & Status Containers -->
    <div id="searchError" class="search-error" style="display: none;">
      <div id="errorContent"></div>
    </div>
    <div id="statusConsole" style="display: none;">
      <div id="statusContent"></div>
    </div>

    <!-- Step 1: Location -->
    <div id="step-location" class="wizard-step active">
      <div class="step-header">
        <span class="step-badge">Schritt 1 von 3</span>
        <h2 id="locationHeadingElement">ğŸ”ï¸ Von wo startest du?</h2>
      </div>
      <p class="step-desc">Gib deinen Standort ein, um prÃ¤zise Fahrzeiten und Stauprognosen zu erhalten.</p>

      <div class="search-group-wizard">
        <div class="input-wrapper-wizard">
          <input type="text" id="addressInput" placeholder="MÃ¼nchen, Marienplatz" autocomplete="off" />
          <button id="locateBtn" class="locate-icon-btn" title="Meinen Standort verwenden">ğŸ“</button>
        </div>
        <button id="submitLocationBtn" class="wizard-next-btn">Weiter</button>
      </div>
    </div>

    <!-- Step 2: Activity Picker -->
    <div id="step-activity" class="wizard-step">
      <div class="step-header">
        <span class="step-badge">Schritt 2 von 3</span>
        <h2>Womit startest du heute?</h2>
      </div>
      <p class="step-desc">WÃ¤hle dein heutiges Winter-Abenteuer.</p>

      <div class="pref-grid" id="activityPicker">
        <button class="pref-btn" data-domain="ski">
          <span class="pref-icon">ğŸ¿</span>
          <span class="pref-label">Skifahren</span>
          <small class="text-gray text-xs">Heute sinnvoll?</small>
        </button>
        <button class="pref-btn" data-domain="skate">
          <span class="pref-icon">â›¸ï¸</span>
          <span class="pref-label">Eislaufen</span>
          <small class="text-gray text-xs">Heute freigegeben?</small>
        </button>
        <button class="pref-btn" data-domain="sled">
          <span class="pref-icon">ğŸ›·</span>
          <span class="pref-label">Rodeln</span>
          <small class="text-gray text-xs">Heute rodelbar?</small>
        </button>
        <button class="pref-btn" data-domain="skitour">
          <span class="pref-icon">ğŸ”ï¸</span>
          <span class="pref-label">Skitour</span>
          <small class="text-gray text-xs">Pulver oder Harsch?</small>
        </button>
      </div>

      <!-- 5th Activity Button (Full Width) -->
      <div class="mt-lg">
        <button class="pref-btn w-full flex-row p-lg" data-domain="walk">
          <span class="pref-icon text-2xl mr-lg">ğŸš¶</span>
          <div class="text-left">
            <span class="pref-label">Winterwanderung</span>
            <small class="text-gray d-block text-sm">Gut begehbar?</small>
          </div>
        </button>
      </div>

      <div class="step-footer mt-lg">
        <button id="backToLocationFromActivity" class="wizard-back-btn">â† ZurÃ¼ck</button>
      </div>
    </div>

    <!-- Step 3: Preferences -->
    <div id="step-prefs" class="wizard-step">
      <div class="step-header">
        <span class="step-badge">Schritt 3 von 3</span>
        <h2>â›·ï¸ Was ist dir heute wichtig?</h2>
      </div>
      <p class="step-desc">Wir passen den SmartScore basierend auf deinen Vorlieben an.</p>

      <div class="pref-grid">
        <button class="pref-btn" data-pref="fast">
          <span class="pref-icon">âš¡</span>
          <span class="pref-label">Schnell dort</span>
        </button>
        <button class="pref-btn" data-pref="near">
          <span class="pref-icon">ğŸ“</span>
          <span class="pref-label">MÃ¶glichst nah</span>
        </button>
        <button class="pref-btn" data-pref="variety">
          <span class="pref-icon">ğŸ¢</span>
          <span class="pref-label">Viel Abwechslung</span>
        </button>
        <button class="pref-btn" data-pref="traffic">
          <span class="pref-icon">ğŸš¦</span>
          <span class="pref-label">Wenig Stau</span>
        </button>
        <button class="pref-btn" data-pref="family">
          <span class="pref-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span>
          <span class="pref-label">Familie</span>
        </button>
        <button class="pref-btn" data-pref="open">
          <span class="pref-icon">ğŸš </span>
          <span class="pref-label">Viel offen</span>
        </button>
        <button class="pref-btn" data-pref="snow">
          <span class="pref-icon">â„ï¸</span>
          <span class="pref-label">Viel Schnee</span>
        </button>
        <button class="pref-btn" data-pref="price">
          <span class="pref-icon">ğŸ’°</span>
          <span class="pref-label">GÃ¼nstig</span>
        </button>
      </div>

      <div class="step-footer d-flex gap-md mt-lg">
        <button id="backToActivity" class="wizard-back-btn">â† ZurÃ¼ck</button>
        <button id="showResultsBtn" class="wizard-next-btn bg-success">Meine Empfehlungen zeigen
          â”</button>
      </div>
    </div>
  </div>

  <!-- Step 3: Results View -->
  <div id="resultsView" class="p-lg d-none">
    <div class="results-top-bar d-flex items-center justify-between mb-lg">
      <h2 id="resultsHeading" class="m-0 text-2xl text-dark"></h2>

      <div class="view-switcher-wizard">
        <button class="view-btn active" data-view="top3">Top 3</button>
        <button class="view-btn" data-view="map">Karte</button>
        <button class="view-btn" data-view="table">Tabelle</button>
      </div>
    </div>

    <!-- Top 3 Recommendation Cards -->
    <div id="top3Cards" class="top3-container"></div>

    <!-- Map View (Hidden by default, used in Step 3) -->
    <div id="map-view" class="d-none h-full w-full my-lg border-radius-lg z-10" style="height: 600px;"></div>

    <!-- Table View (Hidden by default) -->
    <div id="tableView" class="d-none">
      <table id="skiTable">
        <thead>
          <tr class="header-group-row">
            <th colspan="2" class="group-header">Skigebiet</th>
            <th colspan="4" class="group-header group-resort">ğŸ”ï¸ Daten zum Skigebiet</th>
            <th colspan="5" class="group-header group-journey">ğŸš— Anreise & Verkehr</th>
            <th colspan="3" class="group-header group-conditions">â„ï¸ Bedingungen</th>
            <th colspan="2" class="group-header group-extras">â„¹ï¸ Extras</th>
          </tr>
          <tr class="header-col-row">
            <th title="Letzte Aktualisierung der Datenquellen">Daten-Status</th>
            <th>Name</th>
            <th class="tooltip-container">
              Schwierigkeit <span class="text-sm cursor-help">â„¹ï¸</span>
              <div class="tooltip-content">
                <strong>Legende:</strong><br>
                ğŸŸ¢ Familie (AnfÃ¤nger/Familien)<br>
                ğŸŸ¡ Genuss (Landschaft/Entspannt)<br>
                ğŸ”´ Sportlich (Fortgeschrittene)<br>
                ğŸ”µ GroÃŸe Pistenvielfalt<br>
                âš« Gletscher (Hochalpin/Profi)
              </div>
            </th>
            <th data-sort="piste_km" title="Gesamte Pistenkilometer - Klicken zum Sortieren" class="cursor-pointer">
              GrÃ¶ÃŸe (km) â†•ï¸</th>
            <th data-sort="liftsOpen" title="Anzahl geÃ¶ffneter Lifte heute - Klicken zum Sortieren"
              class="cursor-pointer">
              Lifte (Offen) â†•ï¸</th>
            <th data-sort="price" title="Tagesskipass-Preis - Klicken zum Sortieren" class="cursor-pointer">Preis
              (Tagesskipass) â†•ï¸
            </th>
            <th data-sort="distance_km" title="Entfernung in Kilometern - Klicken zum Sortieren" class="cursor-pointer">
              Distanz â†•ï¸</th>
            <th data-sort="distance" title="Fahrzeit ohne Verkehr - Klicken zum Sortieren" class="cursor-pointer">
              Fahrzeit (ohne Verkehrslage) â†•ï¸</th>
            <th data-sort="traffic_delay" title="VerzÃ¶gerung durch Verkehr - Klicken zum Sortieren"
              class="cursor-pointer">
              Stauzeit â†•ï¸</th>
            <th data-sort="traffic_duration" title="Fahrzeit mit aktuellem Verkehr - Klicken zum Sortieren"
              class="cursor-pointer">Fahrzeit (mit Verkehrslage) â†•ï¸</th>
            <th title="Stauprognose basierend auf historischen Daten (aus MÃ¼nchen)">ğŸš¦ Prognose (aus M)</th>
            <th title="Wettervorhersage (3 Tage) - Hover fÃ¼r Details">Wetterprognose</th>
            <th data-sort="snow" title="SchneehÃ¶hen (Berg/Tal) & Letzter Schneefall - Klicken zum Sortieren"
              class="cursor-pointer">
              SchneehÃ¶hen â†•ï¸</th>
            <th title="Link zur Webcam">Webcam</th>
            <th title="Lifte & Pisten Details">Details</th>
            <th data-sort="smartScore" title="SmartScore (0-100) - Klicken zum Sortieren" class="cursor-pointer">
              Score <span id="scoreInfoTrigger" class="cursor-help text-link">â“˜</span> â†•ï¸
            </th>
          </tr>
        </thead>
        <tbody id="resortRows">
        </tbody>
      </table>
    </div> <!-- End of #tableView -->

    <div class="text-center my-lg" style="margin: 40px 0;">
      <button id="restartWizard" class="wizard-restart-btn text-link font-bold cursor-pointer"
        style="background: none; border: 2px solid #3498db; padding: 10px 20px; border-radius: 20px;">â†
        Suche anpassen</button>
    </div>
  </div> <!-- End of #resultsView -->

  <!-- Weather Modal -->
  <div id="weatherModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="weatherResortName">Weather Forecast</h2>
      <div id="weatherForecast" class="weather-forecast">
        <p>Loading...</p>
      </div>
    </div>
  </div>

  <!-- Details Modal -->
  <div id="detailsModal" class="modal">
    <div class="modal-content">
      <span class="close-details">&times;</span>
      <h2 id="detailsResortName">Details</h2>
      <div id="detailsContent"></div>
    </div>
  </div>

  <!-- Score Info Modal -->
  <div id="scoreModal" class="modal">
    <div class="modal-content score-modal-content">
      <span class="close-score">&times;</span>
      <h2>Was ist der SmartScore?</h2>
      <p>Der SmartScore (0-100) bewertet Skigebiete tagesaktuell basierend auf drei Hauptfaktoren:</p>

      <div class="score-breakdown">
        <div class="score-factor">
          <div class="factor-icon">â„ï¸</div>
          <div class="factor-text">
            <strong>Schnee & Pisten (50%)</strong>
            <p>SchneehÃ¶he am Berg und im Tal sowie der Anteil der geÃ¶ffneten Pistenkilometer.</p>
          </div>
        </div>
        <div class="score-factor">
          <div class="factor-icon">ğŸš—</div>
          <div class="factor-text">
            <strong>Erreichbarkeit (30%)</strong>
            <p>Fahrzeit von deinem Standort inklusive aktueller Staumeldungen und VerzÃ¶gerungen.</p>
          </div>
        </div>
        <div class="score-factor">
          <div class="factor-icon">ğŸš </div>
          <div class="factor-text">
            <strong>Angebotsvielfalt (20%)</strong>
            <p>Anzahl der geÃ¶ffneten Lifte und das allgemeine Preis-Leistungs-VerhÃ¤ltnis.</p>
          </div>
        </div>
      </div>

      <blockquote>
        <p><strong>Tipp:</strong> Ein Score Ã¼ber 80 bedeutet perfekte Bedingungen fÃ¼r einen Tagestrip!</p>
      </blockquote>
    </div>
  </div>

  <!-- TRAFFIC MODAL (Formerly History Modal) -->
  <div id="historyModal" class="modal">
    <div class="modal-content">
      <span class="close-history">&times;</span>
      <h2 id="historyResortName">Verkehrsprognose</h2>

      <!-- Content (No Tabs) -->
      <div id="trafficTab" class="tab-content" style="display: block;">
        <p class="info-text">
          Durchschnittliche VerkehrsverzÃ¶gerung pro Wochentag/Uhrzeit (gemittelt Ã¼ber letzten Monat)
        </p>
        <canvas id="trafficHistoryChart"></canvas>
      </div>

    </div>
  </div>




  <script type="module" src="js/app.js"></script>

  <!-- Footer -->
  <footer class="footer-container">
    <div class="footer-content">
      <p class="footer-copyright">
        Â© 2026 Skigebiet-Finder
      </p>
      <p class="text-xs text-gray mt-md">Â© 2025 Skigebiete MÃ¼nchen â€¢ v1.10.1 â€¢ <a href="#" id="imprintLink"
          class="text-link">Impressum</a>
        <span class="text-gray">|</span>
        <a href="datenschutz.html" class="footer-link">DatenschutzerklÃ¤rung</a>
      </p>
      <p class="footer-disclaimer">
        Datenquellen: APIs der Skigebiete (Intermaps/Feratel), Open-Meteo, TomTom, OpenStreetMap
      </p>
    </div>
  </footer>
</body>

</html>