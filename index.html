<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skigebiets-Finder</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Sentry Error Tracking -->
  <script src="https://js-de.sentry-cdn.com/98d563b2786c52b90b69b86e93237434.min.js" crossorigin="anonymous"></script>
  <script type="module" src="js/sentry-config.js"></script>
</head>

<body>


  <h1>ğŸ”ï¸ Skigebiets-Finder</h1>

  <div class="meta">
    Stand: <span id="timestamp">â€“</span> Â· <span style="color: #999;">v1.7.29</span>
    <a href="admin/dashboard.html" target="_blank" title="Admin Dashboard"
      style="text-decoration: none; margin-left: 8px; opacity: 0.5;">âš™ï¸</a>
  </div>




  <!-- Guided Search Wizard -->
  <div id="wizardContainer" class="wizard-container">

    <!-- Step 1: Location -->
    <div id="step-location" class="wizard-step active">
      <div class="step-header">
        <span class="step-badge">Schritt 1 von 2</span>
        <h2>ğŸ”ï¸ Von wo startest du?</h2>
      </div>
      <p class="step-desc">Gib deinen Standort ein, um prÃ¤zise Fahrzeiten und Stauprognosen zu erhalten.</p>

      <div class="search-group-wizard">
        <div class="input-wrapper-wizard">
          <input type="text" id="addressInput" placeholder="MÃ¼nchen, Marienplatz" autocomplete="off" />
          <button id="locateBtn" class="locate-icon-btn" title="Meinen Standort verwenden">ğŸ“</button>
        </div>
        <button id="submitLocationBtn" class="wizard-next-btn">Weiter</button>
      </div>
    </div>

    <!-- Step 2: Preferences -->
    <div id="step-prefs" class="wizard-step" style="display: none;">
      <div class="step-header">
        <span class="step-badge">Schritt 2 von 2</span>
        <h2>â›·ï¸ Was ist dir heute wichtig?</h2>
      </div>
      <p class="step-desc">Wir passen den SmartScore basierend auf deinen Vorlieben an.</p>

      <div class="pref-grid">
        <button class="pref-btn" data-pref="fast">
          <span class="pref-icon">âš¡</span>
          <span class="pref-label">Schnell dort</span>
        </button>
        <button class="pref-btn" data-pref="open">
          <span class="pref-icon">Open</span>
          <span class="pref-label">Viel offen</span>
        </button>
        <button class="pref-btn" data-pref="snow">
          <span class="pref-icon">â„ï¸</span>
          <span class="pref-label">Viel Schnee</span>
        </button>
        <button class="pref-btn" data-pref="price">
          <span class="pref-icon">ğŸ’°</span>
          <span class="pref-label">GÃ¼nstig</span>
        </button>
      </div>

      <div class="step-footer" style="display: flex; gap: 10px; margin-top: 20px;">
        <button id="backToLocation" class="wizard-back-btn">â† ZurÃ¼ck</button>
        <button id="showResultsBtn" class="wizard-next-btn" style="background: #2ecc71;">Meine Empfehlungen zeigen
          â”</button>
      </div>
    </div>
  </div>

  <!-- Step 3: Results View -->
  <div id="resultsView" style="display: none; padding: 0 20px;">
    <div class="results-top-bar"
      style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
      <h2 id="resultsHeading" style="margin: 0; font-size: 1.5em; color: #2c3e50;"></h2>

      <div class="view-switcher-wizard" style="display: flex; background: #eee; border-radius: 20px; padding: 4px;">
        <button class="view-btn active" data-view="top3">Top 3</button>
        <button class="view-btn" data-view="map">Karte</button>
        <button class="view-btn" data-view="table">Tabelle</button>
      </div>
    </div>

    <!-- Top 3 Recommendation Cards -->
    <div id="top3Cards" class="top3-container"></div>

    <!-- Map View (Hidden by default, used in Step 3) -->
    <div id="map-view"
      style="display: none; height: 600px; width: 100%; margin: 20px 0; border-radius: 12px; z-index: 1;"></div>

    <!-- Table View (Hidden by default) -->
    <div id="tableView" style="display: none;">
      <table id="skiTable">
        <thead>
          <tr class="header-group-row">
            <th colspan="2" class="group-header">Skigebiet</th>
            <th colspan="4" class="group-header group-resort">ğŸ”ï¸ Daten zum Skigebiet</th>
            <th colspan="5" class="group-header group-journey">ğŸš— Anreise & Verkehr</th>
            <th colspan="3" class="group-header group-conditions">â„ï¸ Bedingungen</th>
            <th colspan="2" class="group-header group-extras">â„¹ï¸ Extras</th>
          </tr>
          <tr class="header-col-row">
            <th title="Letzte Aktualisierung der Datenquellen">Daten-Status</th>
            <th>Name</th>
            <th class="tooltip-container">
              Schwierigkeit <span style="font-size: 0.8em; cursor: help;">â„¹ï¸</span>
              <div class="tooltip-content">
                <strong>Legende:</strong><br>
                ğŸŸ¢ Familie (AnfÃ¤nger/Familien)<br>
                ğŸŸ¡ Genuss (Landschaft/Entspannt)<br>
                ğŸ”´ Sportlich (Fortgeschrittene)<br>
                ğŸ”µ GroÃŸe Pistenvielfalt<br>
                âš« Gletscher (Hochalpin/Profi)
              </div>
            </th>
            <th data-sort="piste_km" title="Gesamte Pistenkilometer - Klicken zum Sortieren" style="cursor: pointer;">
              GrÃ¶ÃŸe (km) â†•ï¸</th>
            <th data-sort="liftsOpen" title="Anzahl geÃ¶ffneter Lifte heute - Klicken zum Sortieren"
              style="cursor: pointer;">
              Lifte (Offen) â†•ï¸</th>
            <th data-sort="price" title="Tagesskipass-Preis - Klicken zum Sortieren" style="cursor: pointer;">Preis
              (Tagesskipass) â†•ï¸
            </th>
            <th data-sort="distance_km" title="Entfernung in Kilometern - Klicken zum Sortieren"
              style="cursor: pointer;">
              Distanz â†•ï¸</th>
            <th data-sort="distance" title="Fahrzeit ohne Verkehr - Klicken zum Sortieren" style="cursor: pointer;">
              Fahrzeit (ohne Verkehrslage) â†•ï¸</th>
            <th data-sort="traffic_delay" title="VerzÃ¶gerung durch Verkehr - Klicken zum Sortieren"
              style="cursor: pointer;">
              Stauzeit â†•ï¸</th>
            <th data-sort="traffic_duration" title="Fahrzeit mit aktuellem Verkehr - Klicken zum Sortieren"
              style="cursor: pointer;">Fahrzeit (mit Verkehrslage) â†•ï¸</th>
            <th title="Stauprognose basierend auf historischen Daten (aus MÃ¼nchen)">ğŸš¦ Prognose (aus M)</th>
            <th title="Wettervorhersage (3 Tage) - Hover fÃ¼r Details">Wetterprognose</th>
            <th data-sort="snow" title="SchneehÃ¶hen (Berg/Tal) & Letzter Schneefall - Klicken zum Sortieren"
              style="cursor: pointer;">
              SchneehÃ¶hen â†•ï¸</th>
            <th title="Link zur Webcam">Webcam</th>
            <th title="Lifte & Pisten Details">Details</th>
            <th data-sort="smartScore" title="SmartScore (0-100) - Klicken zum Sortieren" style="cursor: pointer;">
              Score <span id="scoreInfoTrigger" style="cursor: help; color: #3498db;">â“˜</span> â†•ï¸
            </th>
          </tr>
        </thead>
        </tbody>
      </table>
    </div> <!-- End of #tableView -->

    <div style="text-align: center; margin: 40px 0;">
      <button id="restartWizard" class="wizard-restart-btn"
        style="background: none; border: 2px solid #3498db; color: #3498db; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer;">â†
        Suche anpassen</button>
    </div>
  </div> <!-- End of #resultsView -->

  <!-- Weather Modal -->
  <div id="weatherModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="weatherResortName">Weather Forecast</h2>
      <div id="weatherForecast" class="weather-forecast">
        <p>Loading...</p>
      </div>
    </div>
  </div>

  <!-- Score Info Modal -->
  <div id="scoreModal" class="modal">
    <div class="modal-content score-modal-content">
      <span class="close-score">&times;</span>
      <h2>Was ist der SmartScore?</h2>
      <p>Der SmartScore (0-100) bewertet Skigebiete tagesaktuell basierend auf drei Hauptfaktoren:</p>

      <div class="score-breakdown">
        <div class="score-factor">
          <div class="factor-icon">â„ï¸</div>
          <div class="factor-text">
            <strong>Schnee & Pisten (50%)</strong>
            <p>SchneehÃ¶he am Berg und im Tal sowie der Anteil der geÃ¶ffneten Pistenkilometer.</p>
          </div>
        </div>
        <div class="score-factor">
          <div class="factor-icon">ğŸš—</div>
          <div class="factor-text">
            <strong>Erreichbarkeit (30%)</strong>
            <p>Fahrzeit von deinem Standort inklusive aktueller Staumeldungen und VerzÃ¶gerungen.</p>
          </div>
        </div>
        <div class="score-factor">
          <div class="factor-icon">ğŸš </div>
          <div class="factor-text">
            <strong>Angebotsvielfalt (20%)</strong>
            <p>Anzahl der geÃ¶ffneten Lifte und das allgemeine Preis-Leistungs-VerhÃ¤ltnis.</p>
          </div>
        </div>
      </div>

      <blockquote>
        <p><strong>Tipp:</strong> Ein Score Ã¼ber 80 bedeutet perfekte Bedingungen fÃ¼r einen Tagestrip!</p>
      </blockquote>
    </div>
  </div>

  <!-- TRAFFIC MODAL (Formerly History Modal) -->
  <div id="historyModal" class="modal">
    <div class="modal-content">
      <span class="close-history">&times;</span>
      <h2 id="historyResortName">Verkehrsprognose</h2>

      <!-- Content (No Tabs) -->
      <div id="trafficTab" class="tab-content" style="display: block;">
        <p class="info-text">
          Durchschnittliche VerkehrsverzÃ¶gerung pro Wochentag/Uhrzeit (gemittelt Ã¼ber letzten Monat)
        </p>
        <canvas id="trafficHistoryChart"></canvas>
      </div>

    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script type="module" src="js/weatherChart.js"></script>
  <script type="module" src="js/app.js"></script>

  <!-- Footer -->
  <footer
    style="margin-top: 60px; padding: 30px 20px; background: #f8f9fa; border-top: 1px solid #e0e0e0; text-align: center;">
    <div style="max-width: 1200px; margin: 0 auto;">
      <p style="margin: 0 0 15px 0; color: #666; font-size: 0.9em;">
        Â© 2026 Skigebiet-Finder
      </p>
      <div style="margin: 15px 0;">
        <a href="impressum.html"
          style="color: #3498db; text-decoration: none; margin: 0 15px; font-weight: 500;">Impressum</a>
        <span style="color: #ccc;">|</span>
        <a href="datenschutz.html"
          style="color: #3498db; text-decoration: none; margin: 0 15px; font-weight: 500;">DatenschutzerklÃ¤rung</a>
      </div>
      <p style="margin: 15px 0 0 0; color: #999; font-size: 0.85em;">
        Datenquellen: APIs der Skigebiete (Intermaps/Feratel), Open-Meteo, TomTom, OpenStreetMap
      </p>
    </div>
  </footer>
</body>

</html>